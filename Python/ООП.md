## Магические методы

**Методы `__new__()` и `__init()__`**
![[Pasted image 20230529173240.png]]

Для выполнения первого шага в классах Python есть специальный`__new__()`Использование метода `__new__()` в классах Python, который отвечает за создание и возврат нового пустого объекта. Затем другой метод `__init__()` принимает результирующий объект вместе с аргументами конструктора класса.
Пример: 
```python
class Point:
    def __new__(cls, *args, **kwargs):
        print("1. Создается новый экземпляр Point.")
        return super().__new__(cls)

    def __init__(self, x, y):
        print("2. Инициализируется новый экземпляр Point.")
        self.x = x
        self.y = y

    def __repr__(self) -> str:
        return f"{type(self).__name__}(x={self.x}, y={self.y})"
```

## Методы класса (classmethod) и статические методы (staticmethod)


## Паттерны проектирования

### Паттерн singleton
Паттерн singleton описывает класс, который позволяет хранить в памяти только один объект.
Пример:
```python
class DataBase:
	__instance = None

	def __new__(cls, *args, **kwargs)
		if cls.__instance is None:
			cls.__instance = super().__new__(cls)
		return cls.__instance

	def __del__(self):
		DataBase.__instance = None

	def __init__(self, user, psw, port)
		self.user = user
		self.psw = psw
		self.port = port

	def connect(self):
		print(f'соединение с БД: {self.user}, {self.psw}, {self.port}')

	def close(self):
		print('соединение разорвано')

	def read(self):
		print 'данные из БД'

	def write(self):
		print(f'запись в БД')

db = DataBase('root', '1111', 80)
db2 = DataBase('user', '2222', 40)
print(id(db), id(db2))
```
Класс создает пользователя с именем, паролем и портом, и для вида имеет несколько методов. Атрибут `__instance = None` - это ссылка на экземпляр класса, по умолчанию равен `None`. Это даёт понять, существует ли объект класса. Переопределённый метод `__new__` проверяет, не существует ли объект класса `DataBase`. Если не существует, вызывается метод `__new__` родительского класса `Object`, создающий новый экземпляр. Если экземпляр уже существует, метод `__new__` возвращает его идентификатор. Метод `__del__` переопределяет идентификатор обратно в `None`. 
`print` выведет два одинаковых числа. Получается, что **переменные db и db2 ссылаются на один и тот же объект.**
**Недостаток этой реализации - обновление полей класса при попытке создания нового экземпляра**
