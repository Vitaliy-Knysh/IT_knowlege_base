# Базы данных

<figure class="table op-uc-figure_align-center op-uc-figure"><table class="op-uc-table"><thead class="op-uc-table--head"><tr class="op-uc-table--row"><th class="op-uc-p op-uc-table--cell op-uc-table--cell_head">host</th><th class="op-uc-p op-uc-table--cell op-uc-table--cell_head">user</th><th class="op-uc-p op-uc-table--cell op-uc-table--cell_head">password</th><th class="op-uc-p op-uc-table--cell op-uc-table--cell_head">database</th><th class="op-uc-p op-uc-table--cell op-uc-table--cell_head">назначение</th></tr></thead><tbody><tr class="op-uc-table--row"><td class="op-uc-p op-uc-table--cell">192.168.33.105</td><td class="op-uc-p op-uc-table--cell">for_test</td><td class="op-uc-p op-uc-table--cell">f0r_te$t</td><td class="op-uc-p op-uc-table--cell">smt_tht</td><td class="op-uc-p op-uc-table--cell">тестовая база данных для отладки действий связанных с получением информации о устройствах</td></tr><tr class="op-uc-table--row"><td class="op-uc-p op-uc-table--cell">192.168.33.164</td><td class="op-uc-p op-uc-table--cell">for_test</td><td class="op-uc-p op-uc-table--cell">f0r_te$t</td><td class="op-uc-p op-uc-table--cell">smt_tht</td><td class="op-uc-p op-uc-table--cell">боевая база данных для действий связанных с получением информации о устройствах</td></tr><tr class="op-uc-table--row"><td class="op-uc-p op-uc-table--cell">192.168.33.164</td><td class="op-uc-p op-uc-table--cell">for_test</td><td class="op-uc-p op-uc-table--cell">f0r_te$t</td><td class="op-uc-p op-uc-table--cell">main</td><td class="op-uc-p op-uc-table--cell">боевая база данных для действий связанных с авторизацией операторов</td></tr></tbody></table></figure>

# Процедуры

## func\_test\_oper\_fix

<figure class="table op-uc-figure_align-center op-uc-figure"><table class="op-uc-table"><tbody><tr class="op-uc-table--row"><th class="op-uc-p op-uc-table--cell op-uc-table--cell_head">База данных</th><td class="op-uc-p op-uc-table--cell"><code class="op-uc-code">smt_tht</code></td></tr></tbody></table></figure>

Параметры

<figure class="table op-uc-figure_align-center op-uc-figure"><table class="op-uc-table"><thead class="op-uc-table--head"><tr class="op-uc-table--row"><th class="op-uc-p op-uc-table--cell op-uc-table--cell_head" style="border:1pt solid windowtext;padding:0 5.4pt;vertical-align:top;width:42.15pt;">№ пп</th><th class="op-uc-p op-uc-table--cell op-uc-table--cell_head" style="border-bottom-style:solid;border-color:windowtext;border-left-style:none;border-right-style:solid;border-top-style:solid;border-width:1pt;padding:0 5.4pt;vertical-align:top;width:113.38pt;">Наименование</th><th class="op-uc-p op-uc-table--cell op-uc-table--cell_head" style="border-bottom-style:solid;border-color:windowtext;border-left-style:none;border-right-style:solid;border-top-style:solid;border-width:1pt;padding:0 5.4pt;vertical-align:top;width:70.85pt;">Тип данных</th><th class="op-uc-p op-uc-table--cell op-uc-table--cell_head" style="border-bottom-style:solid;border-color:windowtext;border-left-style:none;border-right-style:solid;border-top-style:solid;border-width:1pt;padding:0 5.4pt;vertical-align:top;width:73.4pt;">Направление</th><th class="op-uc-p op-uc-table--cell op-uc-table--cell_head" style="border-bottom-style:solid;border-color:windowtext;border-left-style:none;border-right-style:solid;border-top-style:solid;border-width:1pt;padding:0 5.4pt;vertical-align:top;width:436.9pt;">Описание</th></tr></thead><tbody><tr class="op-uc-table--row"><td class="op-uc-p op-uc-table--cell" style="border-bottom-style:solid;border-color:windowtext;border-left-style:solid;border-right-style:solid;border-top-style:none;border-width:1pt;padding:0 5.4pt;vertical-align:top;width:42.15pt;">1</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:113.38pt;">@prod_serial</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:70.85pt;">varchar(32)</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:73.4pt;">In</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:436.9pt;">с/н изделия</td></tr><tr class="op-uc-table--row"><td class="op-uc-p op-uc-table--cell" style="border-bottom-style:solid;border-color:windowtext;border-left-style:solid;border-right-style:solid;border-top-style:none;border-width:1pt;padding:0 5.4pt;vertical-align:top;width:42.15pt;">2</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:113.38pt;">@operator_tn</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:70.85pt;">varchar(8)</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:73.4pt;">In</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:436.9pt;">таб. № оператора</td></tr><tr class="op-uc-table--row"><td class="op-uc-p op-uc-table--cell" style="border-bottom-style:solid;border-color:windowtext;border-left-style:solid;border-right-style:solid;border-top-style:none;border-width:1pt;padding:0 5.4pt;vertical-align:top;width:42.15pt;">3</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:113.38pt;">@oprtn_result_val</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:70.85pt;">Bool</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:73.4pt;">In</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:436.9pt;">результат тестирования: PASS/FAIL . Запись выполняется только при значении PASS.</td></tr><tr class="op-uc-table--row"><td class="op-uc-p op-uc-table--cell" style="border-bottom-style:solid;border-color:windowtext;border-left-style:solid;border-right-style:solid;border-top-style:none;border-width:1pt;padding:0 5.4pt;vertical-align:top;width:42.15pt;">4</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:113.38pt;">@add_info</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:70.85pt;">varchar(256)</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:73.4pt;">In</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:436.9pt;">ссылка на API интерфейса тестирования с подробностями тестирования</td></tr><tr class="op-uc-table--row"><td class="op-uc-p op-uc-table--cell" style="border-bottom-style:solid;border-color:windowtext;border-left-style:solid;border-right-style:solid;border-top-style:none;border-width:1pt;padding:0 5.4pt;vertical-align:top;width:42.15pt;">5</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:113.38pt;">@mode</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:70.85pt;">int</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:73.4pt;">In</td><td class="op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:436.9pt;"><p class="op-uc-p">1 - проверка на валидность значений входных параметров @prod_serial и @operator_tn;</p><p class="op-uc-p">2 - проверка на валидность вх. параметров и последующая запись в БД</p><p class="op-uc-p">3 - получение информации о составе устройства (работает только для временных серийных номеров готовых изедлий (начинаются с <code class="op-uc-code">$</code>))</p><p class="op-uc-p">4 - получение артикула готового изделия (так называемый трехсотый артикул) (работает только для временных серийных номеров готовых изедлий (начинаются с <code class="op-uc-code">$</code>))</p></td></tr><tr class="op-uc-table--row"><td class="op-uc-p op-uc-table--cell" style="border-bottom-style:solid;border-color:windowtext;border-left-style:solid;border-right-style:solid;border-top-style:none;border-width:1pt;padding:0 5.4pt;vertical-align:top;width:42.15pt;">6</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:113.38pt;">@msg_id</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:70.85pt;">int</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:73.4pt;">In/Out</td><td class="op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:436.9pt;"><p class="op-uc-p">Код выполения:</p><p class="op-uc-p">0 - успех;</p><p class="op-uc-p">1 - "С/н продукта не определен"</p><p class="op-uc-p">2 - "Не зафиксирована предыдущая операция "наименование операции"</p><p class="op-uc-p">3 - "Оператор по таб. № не определен"</p></td></tr><tr class="op-uc-table--row"><td class="op-uc-p op-uc-table--cell" style="border-bottom-style:solid;border-color:windowtext;border-left-style:solid;border-right-style:solid;border-top-style:none;border-width:1pt;padding:0 5.4pt;vertical-align:top;width:42.15pt;">7</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:113.38pt;">@msg_txt</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:70.85pt;">varchar(256)</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:73.4pt;">In/Out</td><td class="op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:436.9pt;"><p class="op-uc-p">Описание ошибки. Может иметь значения:</p><p class="op-uc-p">1 - "С/н продукта не определен";</p><p class="op-uc-p">2 - "Не зафиксирована предыдущая операция "наименование операции"";</p><p class="op-uc-p">3 - "Оператор по таб. № не определен".</p></td></tr></tbody></table></figure>

### Возвращаемые значения

#### mode=3

Возвращается N строк в формате `<AQ PartNumber>,<AQ Description>, <Serial Number>`

<figure class="table op-uc-figure_align-center op-uc-figure"><table class="op-uc-table"><thead class="op-uc-table--head"><tr class="op-uc-table--row"><th class="op-uc-p op-uc-table--cell op-uc-table--cell_head">Параметр</th><th class="op-uc-p op-uc-table--cell op-uc-table--cell_head">описание</th></tr></thead><tbody><tr class="op-uc-table--row"><td class="op-uc-p op-uc-table--cell">AQ PartNumber</td><td class="op-uc-p op-uc-table--cell">артикул изделия в 1C ERP</td></tr><tr class="op-uc-table--row"><td class="op-uc-p op-uc-table--cell">AQ Description</td><td class="op-uc-p op-uc-table--cell">некое краткое описание</td></tr><tr class="op-uc-table--row"><td class="op-uc-p op-uc-table--cell">SerialNumber</td><td class="op-uc-p op-uc-table--cell">Серийный номер устройства. Если начинается с # - внутренний Аквариусный серийный номер устройства для устройств не имеющих серийного номера на заводской маркировке, иначе реальный серийный номер, записанный в оборудование</td></tr></tbody></table></figure>

#### mode=4

Возвращается одна строка в формате `<AQ PartNumber 300*>`

<figure class="table op-uc-figure_align-center op-uc-figure"><table class="op-uc-table"><thead class="op-uc-table--head"><tr class="op-uc-table--row"><th class="op-uc-p op-uc-table--cell op-uc-table--cell_head">Параметр</th><th class="op-uc-p op-uc-table--cell op-uc-table--cell_head">описание</th></tr></thead><tbody><tr class="op-uc-table--row"><td class="op-uc-p op-uc-table--cell">AQ PartNumber 300*</td><td class="op-uc-p op-uc-table--cell">артикул готового изделия в 1C ERP - так называемый трехсотый артикл к которому можно вязать мету готового устройства</td></tr></tbody></table></figure>

## ag\_get\_user\_data

<figure class="table op-uc-figure_align-center op-uc-figure"><table class="op-uc-table"><tbody><tr class="op-uc-table--row"><th class="op-uc-p op-uc-table--cell op-uc-table--cell_head">База данных</th><td class="op-uc-p op-uc-table--cell"><code class="op-uc-code">main</code></td></tr></tbody></table></figure>

Параметры

<figure class="table op-uc-figure_align-center op-uc-figure"><table class="op-uc-table"><thead class="op-uc-table--head"><tr class="op-uc-table--row"><th class="op-uc-p op-uc-table--cell op-uc-table--cell_head" style="border:1pt solid windowtext;padding:0 5.4pt;vertical-align:top;width:42.15pt;">№ пп</th><th class="op-uc-p op-uc-table--cell op-uc-table--cell_head" style="border-bottom-style:solid;border-color:windowtext;border-left-style:none;border-right-style:solid;border-top-style:solid;border-width:1pt;padding:0 5.4pt;vertical-align:top;width:113.38pt;">Наименование</th><th class="op-uc-p op-uc-table--cell op-uc-table--cell_head" style="border-bottom-style:solid;border-color:windowtext;border-left-style:none;border-right-style:solid;border-top-style:solid;border-width:1pt;padding:0 5.4pt;vertical-align:top;width:70.85pt;">Тип данных</th><th class="op-uc-p op-uc-table--cell op-uc-table--cell_head" style="border-bottom-style:solid;border-color:windowtext;border-left-style:none;border-right-style:solid;border-top-style:solid;border-width:1pt;padding:0 5.4pt;vertical-align:top;width:73.4pt;">Направление</th><th class="op-uc-p op-uc-table--cell op-uc-table--cell_head" style="border-bottom-style:solid;border-color:windowtext;border-left-style:none;border-right-style:solid;border-top-style:solid;border-width:1pt;padding:0 5.4pt;vertical-align:top;width:436.9pt;">Описание</th></tr></thead><tbody><tr class="op-uc-table--row"><td class="op-uc-p op-uc-table--cell" style="border-bottom-style:solid;border-color:windowtext;border-left-style:solid;border-right-style:solid;border-top-style:none;border-width:1pt;padding:0 5.4pt;vertical-align:top;width:42.15pt;">1</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:113.38pt;">@prod_serial</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:70.85pt;">varchar(32)</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:73.4pt;">In</td><td class="op-uc-p op-uc-table--cell" style="border-bottom:1pt solid windowtext;border-left-style:none;border-right:1pt solid windowtext;border-top-style:none;padding:0 5.4pt;vertical-align:top;width:436.9pt;">пароль пользователя (берется с &nbsp;спец флешки или вводится оператором)</td></tr></tbody></table></figure>

### Возвращаемые значения

Возвращается одна строка в формате `<login>, <tab_number>, <fio>, <status>, <delivery_days>`

<figure class="table op-uc-figure_align-center op-uc-figure"><table class="op-uc-table"><thead class="op-uc-table--head"><tr class="op-uc-table--row"><th class="op-uc-p op-uc-table--cell op-uc-table--cell_head">Параметр</th><th class="op-uc-p op-uc-table--cell op-uc-table--cell_head">описание</th></tr></thead><tbody><tr class="op-uc-table--row"><td class="op-uc-p op-uc-table--cell">login</td><td class="op-uc-p op-uc-table--cell">логин пользователя</td></tr><tr class="op-uc-table--row"><td class="op-uc-p op-uc-table--cell">tab_number</td><td class="op-uc-p op-uc-table--cell">табельный номер пользователя - пользуемся им</td></tr><tr class="op-uc-table--row"><td class="op-uc-p op-uc-table--cell">fio</td><td class="op-uc-p op-uc-table--cell">ФИО на русском</td></tr><tr class="op-uc-table--row"><td class="op-uc-p op-uc-table--cell">status</td><td class="op-uc-p op-uc-table--cell">1 - работает, 0 уволен</td></tr><tr class="op-uc-table--row"><td class="op-uc-p op-uc-table--cell">delivery_days</td><td class="op-uc-p op-uc-table--cell">NULL|int - количество дней с момента трудоустройстваб NULL при status == 0</td></tr></tbody></table></figure>