## SchemeProcessing

Класс **SchemeProcessing(schemas, fields)** используется для формирования готовых схем, имеет единственный метод - **process\_scheme(scheme\_name, descriptions=True)**.

При инициализации класс сохраняет переданные ему схемы и поля.

**Process\_scheme** - обрабатывает данную по имени схему для использования классом **Validator**.

Процесс формирования готовой схемы:

1.  Если схема не была найдена, поднимает исключение _ValueError_.
2.  Если схема содержит поле &quot;**extends**&quot;, рекурсивно обрабатывает схемы, записанные в списке &quot;**extends**&quot; и сохраняет их.
3.  Если не находит требуемое поле в &quot;**fields**&quot;, поднимает исключение _ValueError_.
4.  Для каждого поля записывает его в схему (таким образом, если до этого поле уже было записано из &quot;**extends**&quot;, оно перезапишется на верхнеуровневые данные).
5.  При **descriptions != True**, удаляет описание полей из обработанной схемы.

**Формат сохраненных полей:**

```json
{
 "имя поля": {
  "check": "требуемая проверка, например, bool",
  "description": "описание поля"
 },
 ...
}
```

**Формат заготовки схемы:**

```json
"название схемы": {
 "extends": [
  "название схемы для дополнения", ...
 ],
 "fields": {
  "название поля": {},
  "название поля": {
   "дополнительное поле, например, default": "значение",
   "поле для перезаписи, например, description": "значение",
   ...
  },
  ...
 }
}
```

Схемы и поля хранятся в эластике в индексах &quot;**schemas\_for\_check**&quot; и &quot;**fields**&quot;

## Validator

Класс **validator(schema, data)** служит для валидации данных.

Основной метод - **validate()**.

Процесс валидации:

1.  Добавление всех полей, у которых установлено значение **default**
2.  Добавление всех полей, полученных из переданных данных; при этом, если поле не найдено в схеме, в ошибки записывается &quot;**Redundant field &#39;{field}&#39;**&quot;
3.  Проверка всех полей, если поле есть в схеме, но не было добавлено, в ошибки записывается &quot;**Field &#39;{field}&#39; was not found but required**&quot;; если поле было найдено, проходит валидация его значений через \_**validate\_field(field\_data, check\_type)**; если отсутствует значение &quot;check&quot;, в ошибки записывается &quot;**Field &#39;{field}&#39; has no &#39;check&#39; key**&quot;; если поле не прошло валидацию - в ошибки записывается &quot;**Field &#39;{field}&#39; with data &#39;{result\_data\[field\]}&#39; didn&#39;t pass validation&quot;**
4.  Формирование результата - (словарь с **result** и **data** _либо_ **errors**); если не было ошибок (**result\_bool == True**), возвращаются заполненые и проверенные данные (**data**); если ошибки были (**result\_bool == False**) - возвращает список ошибок (**errors**).

Метод проверки поля - \_**validate\_field(field\_data, check\_type)**

Проверяет данную **field\_data** по **check\_type**. Если **check\_type** не прописан, поднимает _ValueError(&quot;Check type {check\_type} was not found. Add this type to Validator&quot;)_.

На текущий момент проверяется:

*   **float** - соответствие типу float
*   **bool** - соответствие типу bool
*   **elastic\_timestamp** - соответствие timestamp iso-формату